<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepSeek ä»£ç å®¡æŸ¥ç³»ç»Ÿ</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background: #f8f9fa; }
        .card { margin-bottom: 20px; }
        .progress { height: 10px; }
        .agent-status { margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">ğŸ§  DeepSeek ä»£ç å®¡æŸ¥ç³»ç»Ÿ</h1>
        
        <div id="root"></div>

        <!-- ä»…å±•ç¤ºå…³é”® script éƒ¨åˆ†ï¼ˆæŠŠåŸæ¥ç›´æ¥è¯·æ±‚ /upload /start /status çš„ URL æ”¹ä¸ºåç«¯å®é™…è·¯ç”± /api/v1/review/...ï¼‰ -->
        <script type="text/babel">
            const { useState, useEffect } = React;
            
            function App() {
                const [file, setFile] = useState(null);
                const [uploading, setUploading] = useState(false);
                const [taskId, setTaskId] = useState('');
                const [status, setStatus] = useState('ç­‰å¾…ä¸Šä¼ ');
                const [progress, setProgress] = useState(0);
                const [agents, setAgents] = useState([
                    { name: 'ğŸ—ï¸ Architect', status: 'ç­‰å¾…ä¸­', progress: 0 },
                    { name: 'ğŸ” Reviewer', status: 'ç­‰å¾…ä¸­', progress: 0 },
                    { name: 'âš¡ Optimizer', status: 'ç­‰å¾…ä¸­', progress: 0 },
                    { name: 'ğŸ’¾ User_Proxy', status: 'ç­‰å¾…ä¸­', progress: 0 }
                ]);
                
                // æ–‡ä»¶é€‰æ‹©å¤„ç†
                const handleFileSelect = (e) => {
                    const selectedFile = e.target.files[0];
                    if (selectedFile && selectedFile.name.endsWith('.py')) {
                        setFile(selectedFile);
                        setStatus('æ–‡ä»¶å·²é€‰æ‹©: ' + selectedFile.name);
                    } else {
                        alert('è¯·é€‰æ‹© .py æ–‡ä»¶');
                    }
                };
                
                // 4. æ–‡ä»¶ä¸Šä¼ 
                const uploadFile = async () => {
                    if (!file) {
                        alert('è¯·å…ˆé€‰æ‹©æ–‡ä»¶');
                        return;
                    }
                    
                    setUploading(true);
                    setStatus('ä¸Šä¼ ä¸­...');
                    
                    const formData = new FormData();
                    formData.append('file', file);
                    
                    try {
                        // æ”¹ä¸ºåç«¯å®é™…è·¯å¾„ï¼šPOST /api/v1/review/upload
                        const response = await fetch('http://localhost:8000/api/v1/review/upload', {
                            method: 'POST',
                            body: formData
                        });
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            setTaskId(result.task_id);
                            setStatus('ä¸Šä¼ æˆåŠŸï¼ä»»åŠ¡ID: ' + result.task_id);
                            alert('ä¸Šä¼ æˆåŠŸï¼ç‚¹å‡»"å¼€å§‹å®¡æŸ¥"æŒ‰é’®è¿›è¡Œåˆ†æ');
                        } else {
                            throw new Error(result.error || 'ä¸Šä¼ å¤±è´¥');
                        }
                    } catch (error) {
                        setStatus('ä¸Šä¼ å¤±è´¥: ' + error.message);
                        alert('ä¸Šä¼ å¤±è´¥: ' + error.message);
                    } finally {
                        setUploading(false);
                    }
                };
                
                // 5. å¼€å§‹å®¡æŸ¥
                const startReview = async () => {
                    if (!taskId) {
                        alert('è¯·å…ˆä¸Šä¼ æ–‡ä»¶');
                        return;
                    }
                    
                    setStatus('å¼€å§‹å®¡æŸ¥...');
                    setProgress(0);
                    
                    try {
                        // start è·¯ç”±æœŸæœ› query å‚æ•° task_idï¼šPOST /api/v1/review/start?task_id={task_id}
                        const response = await fetch(`http://localhost:8000/api/v1/review/start?task_id=${encodeURIComponent(taskId)}`, {
                            method: 'POST'
                        });
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            setStatus('å®¡æŸ¥å·²å¼€å§‹ï¼Œæ­£åœ¨å¤„ç†ä¸­...');
                            // è½®è¯¢çŠ¶æ€
                            pollStatus();
                        } else {
                            throw new Error(result.error || 'å¯åŠ¨å¤±è´¥');
                        }
                    } catch (error) {
                        setStatus('å¯åŠ¨å¤±è´¥: ' + error.message);
                    }
                };
                
                // 6. è½®è¯¢çŠ¶æ€
                const pollStatus = async () => {
                    if (!taskId) return;
                    
                    try {
                        // æ”¹ä¸ºåç«¯å®é™… status è·¯ç”±ï¼šGET /api/v1/review/status/{task_id}
                        const response = await fetch(`http://localhost:8000/api/v1/review/status/${encodeURIComponent(taskId)}`);
                        const data = await response.json();
                        
                        if (data.success) {
                            setStatus(data.task?.message || 'å¤„ç†ä¸­');
                            // ä¾æ®è¿”å›çŠ¶æ€æ›´æ–°è¿›åº¦ç­‰
                        } else {
                            setStatus('æŸ¥è¯¢çŠ¶æ€å¤±è´¥');
                        }
                    } catch (error) {
                        setStatus('æŸ¥è¯¢çŠ¶æ€å¤±è´¥: ' + error.message);
                    }
                };
                
                // å…¶ä½™ä»£ç ä¸å˜...
            }
        </script>

    </div>
</body>
</html>